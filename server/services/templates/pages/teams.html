{{define "content"}}

<style>
  /* High-Fantasy Theme Styles */
  
  /* Full-page background */
  .teams-container {
    min-height: 100vh;
    background-image: url("/static/images/welcome_bg.png");
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    position: relative;
  }
  
  /* Dark overlay */
  .teams-container::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.6);
    z-index: 0;
  }
  
  /* Content layer */
  .content-layer {
    position: relative;
    z-index: 1;
  }
  
  /* Team cards - Glass morphism with fantasy borders */
  .team-card {
    background: rgba(26, 26, 46, 0.85);
    border: 2px solid rgba(103, 80, 164, 0.3);
    border-radius: 16px;
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    transition: transform 0.3s, box-shadow 0.3s;
    height: 100%;
  }
  
  .team-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 48px rgba(103, 80, 164, 0.6);
    border-color: rgba(103, 80, 164, 0.6);
  }
  
  /* Status badges */
  .status-badge {
    font-size: 0.875rem;
    font-weight: 600;
    padding: 0.5rem 1rem;
  }
  
  .status-badge.available {
    background: linear-gradient(135deg, #10b981, #059669);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }
  
  .status-badge.expedition {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    animation: pulse 2s infinite;
  }
  
  .status-badge.locked {
    background: linear-gradient(135deg, #6b7280, #4b5563);
    box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
  }
  
  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
  }
  
  /* Equipment slots */
  .equipment-slot {
    border: 3px solid transparent;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.4);
    padding: 1rem;
    transition: all 0.3s;
    cursor: pointer;
    min-height: 90px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  
  .equipment-slot:hover {
    transform: scale(1.05);
    background: rgba(0, 0, 0, 0.6);
  }
  
  /* Rarity border colors */
  .rarity-common { border-color: #9e9e9e; }
  .rarity-uncommon { border-color: #4caf50; }
  .rarity-rare { border-color: #2196f3; }
  .rarity-epic { border-color: #9c27b0; }
  .rarity-legendary { 
    border-color: #ff9800;
    box-shadow: 0 0 20px rgba(255, 152, 0, 0.5);
  }
  
  /* Expedition timer */
  .expedition-timer {
    font-family: 'Courier New', monospace;
    font-size: 1.1rem;
    color: #60a5fa;
    text-shadow: 0 0 10px rgba(96, 165, 250, 0.5);
    font-weight: bold;
  }
  
  /* Stats cards */
  .stat-card {
    background: rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    padding: 0.75rem;
    transition: all 0.3s;
  }
  
  .stat-card:hover {
    background: rgba(0, 0, 0, 0.7);
    transform: translateY(-2px);
  }
  
  /* Locked team overlay */
  .locked-overlay {
    background: rgba(0, 0, 0, 0.7);
    border-radius: 12px;
    padding: 3rem 1rem;
  }
  
  /* Progress bar custom styling */
  .expedition-progress {
    height: 10px;
    border-radius: 5px;
    background: rgba(0, 0, 0, 0.5);
    overflow: hidden;
  }
  
  .expedition-progress .progress-bar {
    background: linear-gradient(90deg, #3b82f6, #60a5fa);
    box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
    transition: width 1s ease;
  }
  
  /* Page header */
  .page-header {
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
  }
  
  /* Bootstrap popover custom styling */
  .popover {
    background: rgba(26, 26, 46, 0.95);
    border: 2px solid rgba(103, 80, 164, 0.5);
    backdrop-filter: blur(10px);
  }
  
  .popover-body {
    color: #fff;
  }
  
  .popover-header {
    background: rgba(103, 80, 164, 0.3);
    border-bottom: 1px solid rgba(103, 80, 164, 0.5);
    color: #fff;
  }
  
  .bs-popover-top > .popover-arrow::after,
  .bs-popover-auto[data-popper-placement^="top"] > .popover-arrow::after {
    border-top-color: rgba(26, 26, 46, 0.95);
  }
</style>

<div class="teams-container">
  {{template "navbar" .}}
  
  <div class="container py-5 content-layer">
    <!-- Page Header -->
    <div class="text-center mb-5 page-header">
      <h1 class="display-4 text-white fw-bold mb-3">
        <i class="fas fa-users me-3"></i>Your Expedition Teams
      </h1>
      <p class="lead text-white-50">Manage your teams and prepare for dimensional rifts</p>
    </div>
    
    <!-- Teams Grid -->
    <div class="row g-4">
      {{range .Data.Teams}}
      <div class="col-lg-4 col-md-6">
        <div class="team-card p-4">
          <!-- Team Header -->
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="text-white mb-0">
              <i class="fas fa-shield-alt me-2" style="color: #6750a4;"></i>Team {{.TeamNumber}}
            </h3>
            
            <!-- Status Badge -->
            {{if .IsUnlocked}}
              {{if .OnExpedition}}
                <span class="status-badge expedition badge rounded-pill">
                  <i class="fas fa-rocket me-1"></i>On Expedition
                </span>
              {{else}}
                <span class="status-badge available badge rounded-pill">
                  <i class="fas fa-check-circle me-1"></i>Available
                </span>
              {{end}}
            {{else}}
              <span class="status-badge locked badge rounded-pill">
                <i class="fas fa-lock me-1"></i>Locked
              </span>
            {{end}}
          </div>
          
          <!-- If Locked, show unlock requirements -->
          {{if not .IsUnlocked}}
            <div class="locked-overlay text-center">
              <i class="fas fa-lock fa-4x text-muted mb-4" style="opacity: 0.3;"></i>
              <p class="text-white-50 fs-5 mb-0">{{.UnlockRequirement}}</p>
            </div>
          {{else}}
            
            <!-- If On Expedition, show expedition details -->
            {{if .OnExpedition}}
              <div class="mb-4 p-3 rounded" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3);">
                <div class="d-flex align-items-center mb-2">
                  <i class="fas fa-dungeon me-2 text-primary"></i>
                  <span class="text-white fw-bold">{{.ExpeditionData.RiftName}}</span>
                </div>
                <div class="expedition-timer text-center my-3" 
                     data-expedition-id="{{.ExpeditionData.ID}}"
                     data-completion-time="{{.ExpeditionData.CompletionTime}}"
                     data-duration-minutes="{{.ExpeditionData.DurationMinutes}}"
                     data-time-remaining="{{if .ExpeditionData.TimeRemaining}}{{.ExpeditionData.TimeRemaining}}{{else}}0{{end}}">
                  Calculating...
                </div>
                <div class="expedition-progress progress">
                  <div class="progress-bar" role="progressbar" style="width: 0%" data-expedition-id="{{.ExpeditionData.ID}}"></div>
                </div>
              </div>
            {{end}}
            
            <!-- Team Stats -->
            <div class="mb-4">
              <h5 class="text-white-50 mb-3 d-flex align-items-center">
                <i class="fas fa-chart-line me-2"></i>Stats
              </h5>
              <div class="row g-2">
                <div class="col-4">
                  <div class="stat-card text-center">
                    <i class="fas fa-bolt text-warning fs-4 mb-1"></i>
                    <div class="text-white fw-bold fs-5">{{printf "%.1f" .TotalStats.Speed}}</div>
                    <small class="text-white-50">Speed</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="stat-card text-center">
                    <i class="fas fa-clover text-success fs-4 mb-1"></i>
                    <div class="text-white fw-bold fs-5">{{printf "%.1f" .TotalStats.Luck}}</div>
                    <small class="text-white-50">Luck</small>
                  </div>
                </div>
                <div class="col-4">
                  <div class="stat-card text-center">
                    <i class="fas fa-fist-raised text-danger fs-4 mb-1"></i>
                    <div class="text-white fw-bold fs-5">{{.TotalStats.Power}}</div>
                    <small class="text-white-50">Power</small>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Equipment Slots -->
            <div>
              <h5 class="text-white-50 mb-3 d-flex align-items-center">
                <i class="fas fa-boxes-stacked me-2"></i>Equipment
              </h5>
              <div class="row g-3">
                <!-- Weapon Slot -->
                <div class="col-6">
                  {{if and .EquippedWeapon .EquippedWeapon.Name}}
                    <div class="equipment-slot rarity-{{.EquippedWeapon.Rarity}}"
                         data-bs-toggle="popover" 
                         data-bs-trigger="hover"
                         data-bs-placement="top"
                         data-bs-html="true"
                         data-bs-content="<strong>{{.EquippedWeapon.Name}}</strong><br><small class='text-white-50'>{{.EquippedWeapon.Rarity}}</small><hr class='my-1'><i class='fas fa-bolt text-warning'></i> Speed: +{{printf "%.1f" .EquippedWeapon.SpeedBonus}}<br><i class='fas fa-clover text-success'></i> Luck: +{{printf "%.1f" .EquippedWeapon.LuckBonus}}<br><i class='fas fa-fist-raised text-danger'></i> Power: +{{.EquippedWeapon.PowerBonus}}">
                      <i class="fas fa-wand-sparkles fa-2x text-white mb-1"></i>
                      <div class="small text-white-50">Weapon</div>
                    </div>
                  {{else}}
                    <div class="equipment-slot">
                      <i class="fas fa-wand-sparkles fa-2x text-muted mb-1" style="opacity: 0.3;"></i>
                      <div class="small text-white-50">Empty</div>
                    </div>
                  {{end}}
                </div>
                
                <!-- Armor Slot -->
                <div class="col-6">
                  {{if and .EquippedArmor .EquippedArmor.Name}}
                    <div class="equipment-slot rarity-{{.EquippedArmor.Rarity}}"
                         data-bs-toggle="popover" 
                         data-bs-trigger="hover"
                         data-bs-placement="top"
                         data-bs-html="true"
                         data-bs-content="<strong>{{.EquippedArmor.Name}}</strong><br><small class='text-white-50'>{{.EquippedArmor.Rarity}}</small><hr class='my-1'><i class='fas fa-bolt text-warning'></i> Speed: +{{printf "%.1f" .EquippedArmor.SpeedBonus}}<br><i class='fas fa-clover text-success'></i> Luck: +{{printf "%.1f" .EquippedArmor.LuckBonus}}<br><i class='fas fa-fist-raised text-danger'></i> Power: +{{.EquippedArmor.PowerBonus}}">
                      <i class="fas fa-shield fa-2x text-white mb-1"></i>
                      <div class="small text-white-50">Armor</div>
                    </div>
                  {{else}}
                    <div class="equipment-slot">
                      <i class="fas fa-shield fa-2x text-muted mb-1" style="opacity: 0.3;"></i>
                      <div class="small text-white-50">Empty</div>
                    </div>
                  {{end}}
                </div>
                
                <!-- Accessory Slot -->
                <div class="col-4">
                  {{if and .EquippedAccessory .EquippedAccessory.Name}}
                    <div class="equipment-slot rarity-{{.EquippedAccessory.Rarity}}"
                         data-bs-toggle="popover" 
                         data-bs-trigger="hover"
                         data-bs-placement="top"
                         data-bs-html="true"
                         data-bs-content="<strong>{{.EquippedAccessory.Name}}</strong><br><small class='text-white-50'>{{.EquippedAccessory.Rarity}}</small><hr class='my-1'><i class='fas fa-bolt text-warning'></i> Speed: +{{printf "%.1f" .EquippedAccessory.SpeedBonus}}<br><i class='fas fa-clover text-success'></i> Luck: +{{printf "%.1f" .EquippedAccessory.LuckBonus}}<br><i class='fas fa-fist-raised text-danger'></i> Power: +{{.EquippedAccessory.PowerBonus}}">
                      <i class="fas fa-ring fa-2x text-white mb-1"></i>
                      <div class="small text-white-50">Accessory</div>
                    </div>
                  {{else}}
                    <div class="equipment-slot">
                      <i class="fas fa-ring fa-2x text-muted mb-1" style="opacity: 0.3;"></i>
                      <div class="small text-white-50">Empty</div>
                    </div>
                  {{end}}
                </div>
                
                <!-- Artifact Slot -->
                <div class="col-4">
                  {{if and .EquippedArtifact .EquippedArtifact.Name}}
                    <div class="equipment-slot rarity-{{.EquippedArtifact.Rarity}}"
                         data-bs-toggle="popover" 
                         data-bs-trigger="hover"
                         data-bs-placement="top"
                         data-bs-html="true"
                         data-bs-content="<strong>{{.EquippedArtifact.Name}}</strong><br><small class='text-white-50'>{{.EquippedArtifact.Rarity}}</small><hr class='my-1'><i class='fas fa-bolt text-warning'></i> Speed: +{{printf "%.1f" .EquippedArtifact.SpeedBonus}}<br><i class='fas fa-clover text-success'></i> Luck: +{{printf "%.1f" .EquippedArtifact.LuckBonus}}<br><i class='fas fa-fist-raised text-danger'></i> Power: +{{.EquippedArtifact.PowerBonus}}">
                      <i class="fas fa-scroll fa-2x text-white mb-1"></i>
                      <div class="small text-white-50">Artifact</div>
                    </div>
                  {{else}}
                    <div class="equipment-slot">
                      <i class="fas fa-scroll fa-2x text-muted mb-1" style="opacity: 0.3;"></i>
                      <div class="small text-white-50">Empty</div>
                    </div>
                  {{end}}
                </div>
                
                <!-- Relic Slot -->
                <div class="col-4">
                  {{if and .EquippedRelic .EquippedRelic.Name}}
                    <div class="equipment-slot rarity-{{.EquippedRelic.Rarity}}"
                         data-bs-toggle="popover" 
                         data-bs-trigger="hover"
                         data-bs-placement="top"
                         data-bs-html="true"
                         data-bs-content="<strong>{{.EquippedRelic.Name}}</strong><br><small class='text-white-50'>{{.EquippedRelic.Rarity}}</small><hr class='my-1'><i class='fas fa-bolt text-warning'></i> Speed: +{{printf "%.1f" .EquippedRelic.SpeedBonus}}<br><i class='fas fa-clover text-success'></i> Luck: +{{printf "%.1f" .EquippedRelic.LuckBonus}}<br><i class='fas fa-fist-raised text-danger'></i> Power: +{{.EquippedRelic.PowerBonus}}">
                      <i class="fas fa-hat-wizard fa-2x text-white mb-1"></i>
                      <div class="small text-white-50">Relic</div>
                    </div>
                  {{else}}
                    <div class="equipment-slot">
                      <i class="fas fa-hat-wizard fa-2x text-muted mb-1" style="opacity: 0.3;"></i>
                      <div class="small text-white-50">Empty</div>
                    </div>
                  {{end}}
                </div>
              </div>
            </div>
          {{end}}
        </div>
      </div>
      {{end}}
    </div>
  </div>
</div>

<script>
  // Initialize Bootstrap popovers
  document.addEventListener('DOMContentLoaded', function() {
    // Initialize popovers
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    popoverTriggerList.map(function (popoverTriggerEl) {
      return new bootstrap.Popover(popoverTriggerEl);
    });
    
    // Start countdown timers
    updateTimers();
    setInterval(updateTimers, 1000);
  });
  
  function updateTimers() {
    document.querySelectorAll('.expedition-timer').forEach(timer => {
      const timeRemaining = parseInt(timer.dataset.timeRemaining);
      const durationMinutes = parseInt(timer.dataset.durationMinutes);
      const expeditionId = timer.dataset.expeditionId;
      
      if (timeRemaining > 0) {
        // Calculate time display
        const hours = Math.floor(timeRemaining / 3600);
        const minutes = Math.floor((timeRemaining % 3600) / 60);
        const seconds = timeRemaining % 60;
        
        // Format with leading zeros
        const hoursStr = hours > 0 ? hours + 'h ' : '';
        const minutesStr = minutes.toString().padStart(2, '0') + 'm ';
        const secondsStr = seconds.toString().padStart(2, '0') + 's';
        
        timer.textContent = hoursStr + minutesStr + secondsStr + ' remaining';
        
        // Update progress bar
        const progressBar = document.querySelector(`.progress-bar[data-expedition-id="${expeditionId}"]`);
        if (progressBar) {
          const totalSeconds = durationMinutes * 60;
          const elapsedSeconds = totalSeconds - timeRemaining;
          const progressPercent = (elapsedSeconds / totalSeconds) * 100;
          progressBar.style.width = progressPercent + '%';
        }
        
        // Decrement time remaining
        timer.dataset.timeRemaining = timeRemaining - 1;
      } else if (timeRemaining === 0) {
        timer.textContent = 'Expedition Complete!';
        timer.style.color = '#10b981';
        
        // Set progress bar to 100%
        const progressBar = document.querySelector(`.progress-bar[data-expedition-id="${expeditionId}"]`);
        if (progressBar) {
          progressBar.style.width = '100%';
          progressBar.style.background = 'linear-gradient(90deg, #10b981, #059669)';
        }
      }
    });
  }
</script>

{{end}}
